const MIN_EDAD=2,ERRCODE=new Map([[256,"Permiso denegado"],[276,"DNI ya registrado"],[277,"Email ya registrado"],[278,"Telefono ya registrado"],[288,"Cuenta no activada"],[289,"Se requiere cambio de contraseña"],[290,"Credenciales inválidas"],[779,"La reserva no se puede borrar, ya que ha sido pagada"]]);var $=document.getElementById.bind(document),$$=document.querySelector.bind(document),$$$=document.querySelectorAll.bind(document);function may(f,...args){try{return f(...args)}catch{}}function showError(code){code=parseInt(code);let msg=ERRCODE.get(code);msg=msg||"",alert(`❌ Error: ${msg} (0x${code.toString(16).padStart(4,"0")})`)}function create(type,id="",className="",html=!1){type=document.createElement(type);return type.id=id,type.className=className,html&&(type.innerHTML=html),type}function calcEdad(nacimimento){nacimimento=new Date(nacimimento),nacimimento=Date.now()-nacimimento.getTime();return{years:new Date(nacimimento).getUTCFullYear()-1970,negative:nacimimento<0}}function formDataToJSON(formData){var object={};return formData.forEach((value,key)=>{Reflect.has(object,key)?(Array.isArray(object[key])||(object[key]=[object[key]]),object[key].push(value)):object[key]=value}),object}function fetchJson(url,send=null,method="POST"){return new Promise(async resolve=>{var resp=await fetch(url,{method:method,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(send)});let json={};try{json=await resp.json()}catch{}json._httpCode=resp.status,resolve(json)})}function simpleModal(content){let el=$("simpleModal");var innerDiv;!content&&el?el.remove():el||(el=create("div","simpleModal"),(innerDiv=create("div")).innerHTML=content,el.appendChild(innerDiv),document.body.appendChild(el))}function changeScreen(number,element=document.body){for(var s of element.querySelectorAll(".screen"))s.classList.remove("active");element.querySelector(`.screen[data-screen="${number}"]`).classList.add("active")}class slideShow{constructor(element,time=2){this.time=1e3*time,this.imgs=$$$(`#${element} div`),this.count=this.imgs.length,this.current=0,this.interval}next(){this.imgs.forEach(s=>{s.className=""});var nx=this.current%this.count;this.imgs[nx].className="visible",this.current++}start(){this.next();var self=this;this.interval=setInterval(()=>self.next(),this.time)}stop(){clearInterval(this.interval)}}class gallery{constructor(element){this.element=element,this.imgs=element.querySelectorAll("img"),this.count=this.imgs.length;for(let i=this.current=0;i<this.count;i++)this.imgs[i].onclick=()=>{history.pushState({},"","#"+i),this.show()};this.div=create("div","galleryModal"),this.div.onclick=()=>{history.back()},this.img=create("img"),this.div.appendChild(this.img),document.body.appendChild(this.div),window.addEventListener("popstate",()=>{this.show()}),this.show()}show(){var n;location.hash?(n=location.hash.substring(1),this.imgs[n]?(this.img.src=this.imgs[n].src.replace("thumbs/",""),this.div.classList.add("visible")):history.replaceState("","",window.location.pathname)):(this.img.src="",this.div.classList.remove("visible"))}}class USER{static checkProfileForm(newuser){var input,f=$("formProfile"),errors=[];let e,v,p;for(input of f.querySelectorAll('[type="text"],[type="tel"],[type="email"]'))input.value=input.value.trim();return e=f.nombre,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere el nombre y apellidos del adulto"),p.classList.add("invalid")):v.length<3?(errors.push("❌ El nombre debe contener al menos tres letras"),p.classList.add("invalid")):v.split(" ")[1]?e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El nombre solo puede contener letras"),p.classList.add("invalid")):(errors.push("❌ Debes introducir al menos un apellido"),p.classList.add("invalid")),e=f.DNI,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere DNI o NIE"),p.classList.add("invalid")):v.length<5?(errors.push("❌ El DNI/NIE debe contener al menos 5 cifras"),p.classList.add("invalid")):e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El DNI/NIE solo puede contener números y letras"),p.classList.add("invalid")),e=f.email,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere correo electrónico válido"),p.classList.add("invalid")):e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El correo electrónico no es válido"),p.classList.add("invalid")),e=f.telefono,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere teléfono"),p.classList.add("invalid")):e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El teléfono no es válido"),p.classList.add("invalid")),e=f.pass,p=e.parentElement,v=e.value,newuser||f.pass.value?f.pass.value.length<6?(errors.push("❌ La contraseña debe tener más de 6 caracteres"),p.classList.add("invalid")):f.pass.value!=f.passConfirm.value?(errors.push("❌ Las contraseñas deben coincidir"),p.classList.add("invalid")):p.classList.remove("invalid"):p.classList.remove("invalid"),newuser&&(e=f.acepto,p=e.parentElement,(v=e.checked)?p.classList.remove("invalid"):(errors.push("❌ Debe aceptar las condiciones legales"),p.classList.add("invalid"))),!errors.length||(alert("Se encontraron los siguientes errores:\n"+errors.join("\n")),!1)}static async sendProfileForm(newuser){var f=$("formProfile"),f=new FormData(f),resp=await fetchJson("/api/adulto,"+(newuser?"nuevo":"modificar"),Object.fromEntries(f));if(0!=resp.status)return showError(resp.status),!1;newuser?($("sentMail").textContent=f.get("email"),changeScreen(2)):location="/perfil"}static checkTeamForm(){var input,f=$("formTeam"),errors=[];let e,v,p;for(input of f.querySelectorAll('[type="text"]'))input.value=input.value.trim();return e=f.titulo,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere el título del equipo"),p.classList.add("invalid")):v.length<3?(errors.push("❌ El título debe contener al menos tres letras"),p.classList.add("invalid")):e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El título solo puede contener letras y números"),p.classList.add("invalid")),e=f.nombre,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere el nombre y apellidos del menor"),p.classList.add("invalid")):v.length<3?(errors.push("❌ El nombre debe contener al menos tres letras"),p.classList.add("invalid")):v.split(" ")[1]?e.checkValidity()?p.classList.remove("invalid"):(errors.push("❌ El nombre solo puede contener letras"),p.classList.add("invalid")):(errors.push("❌ Debes introducir al menos un apellido"),p.classList.add("invalid")),e=f.nacimiento,p=e.parentElement,""==(v=e.value)?(errors.push("❌ Se requiere el nacimiento"),p.classList.add("invalid")):(f=calcEdad(v)).negative?(errors.push("❌ La fecha de nacimimento no puede ser en el futuro"),p.classList.add("invalid")):f.years<MIN_EDAD?(errors.push(`❌ El menor debe tener al menos ${MIN_EDAD} años`),p.classList.add("invalid")):p.classList.remove("invalid"),!errors.length||(alert("Se encontraron los siguientes errores:\n"+errors.join("\n")),!1)}static async sendTeamForm(){var f=$("formTeam"),f=new FormData(f),resp=await fetchJson("/api/equipo,"+(f.get("id")?"modificar":"nuevo"),Object.fromEntries(f));switch(Number(resp.status)){case 0:location="/perfil";break;case 523:alert("❌ Ya existe un equipo con ese titulo");break;default:showError(resp.status)}return!1}static async sendTeamDelete(){var f=$("formTeam"),f=await fetchJson("/api/equipo,borrar,"+new FormData(f).get("id"));if(0!=f.status)return showError(f.status),!1;location="/perfil"}static async sendLoginForm(){var f=$("formLogin"),f=new FormData(f),f=await fetchJson("/api/adulto,entrar",Object.fromEntries(f));if(0!=f.status)return showError(f.status),!1;location="/perfil"}static async unlog(){var resp=await fetchJson("/api/adulto,salir");if(0!=resp.status)return showError(resp.status),!1;location.reload()}}class PICS{static init(){new gallery($$(".galleryPics"))}}class RESERVAS{static init(){var el;for(el of $("misreservas").querySelectorAll(".showCancelRes"))el.onclick=e=>{e=e.currentTarget.dataset.rid;changeScreen(2,$("ev"+e))};for(let el of $$$(".cancelCancel"))el.onclick=e=>{e=e.currentTarget.dataset.rid;changeScreen(1,$("ev"+e))};for(let el of $$$(".cancelRes"))el.onclick=e=>{e=e.currentTarget.dataset.rid;this.cancelReserva(e)}}static checkReservaForm(){var errors=[],e=$("formReserva").equipos,p=e.parentElement;return 0==e.querySelectorAll("option:checked").length?(errors.push("❌ Se requiere al menos un equipo"),p.classList.add("invalid")):p.classList.remove("invalid"),!errors.length||(alert("Se encontraron los siguientes errores:\n"+errors.join("\n")),!1)}static async sendReservaForm(){var f=$("formReserva"),f=new FormData(f),resp=await fetchJson("/api/reserva,"+(f.get("id")?"modificar":"nueva"),formDataToJSON(f));switch(Number(resp.status)){case 0:location="/perfil/reservas";break;case 775:alert("❌ Algún equipo no está disponible en la fecha seleccionada");break;default:showError(resp.status)}return!1}static async cancelReserva(rid){rid=await fetchJson("/api/reserva,cancelar,"+rid);if(0!=rid.status)return showError(rid.status),!1;location.reload()}}function hideMainMenu(e){e.target.closest("#mainMenu")||($("mainMenu").classList.remove("visible"),document.removeEventListener("click",hideMainMenu))}function hideProfileMenu(e){e.target.closest("#profileMenu")||($("profileMenu").classList.remove("visible"),document.removeEventListener("click",hideProfileMenu))}class WEB{static init(){var mainBut=$("toggle-mainMenu"),mainBut=(mainBut&&(mainBut.onclick=e=>{e.stopPropagation();e=$("mainMenu");e.classList.contains("visible")?document.removeEventListener("click",hideMainMenu):document.addEventListener("click",hideMainMenu),e.classList.toggle("visible")}),$("toggle-profileMenu")),mainBut=(mainBut&&(mainBut.onclick=e=>{e.stopPropagation();e=$("profileMenu");e.classList.contains("visible")?document.removeEventListener("click",hideProfileMenu):document.addEventListener("click",hideProfileMenu),e.classList.toggle("visible")}),$("userUnlog"));mainBut&&($("userUnlog").onclick=()=>{fetchJson("/api/adulto,salir").then(data=>{0==data.status&&location.reload()})})}}export{$,$$,$$$,may,create,fetchJson,showError,simpleModal,changeScreen,slideShow,USER,PICS,RESERVAS,WEB};
//# sourceMappingURL=module-web.min.js.map