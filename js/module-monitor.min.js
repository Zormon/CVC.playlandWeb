import{$,fetchJson,virtualKeyboard}from"/js/module-admin.min.js?v4";import QrScanner from"/js/qr-scanner.min.js";class START{static participar(prueba,dorsal){location=`/monitor/${prueba}/${dorsal.toString().padStart(4,"0")}/`}static init(){new virtualKeyboard("teclado"),localStorage.prueba||(localStorage.prueba=$("prueba").firstElementChild.value),$("prueba").value=localStorage.prueba,$("prueba").value||($("prueba").value=$("prueba").querySelector("option").value,localStorage.prueba=$("prueba").value),$("prueba").dataset.sel=localStorage.prueba,$("prueba").onchange=e=>{confirm("¿Seguro que quieres cambiar de prueba este dispositivo?")?(e.currentTarget.dataset.sel=e.currentTarget.value,localStorage.prueba=e.currentTarget.value):e.currentTarget.value=e.currentTarget.dataset.sel},$("participar").onclick=e=>{e.preventDefault();e=$("dorsal").value;0<e.length&&this.participar($("prueba").value,e)};const qrScan=new QrScanner($("qrVideo"),async res=>{if("e:"==res.data.substr(0,2)){var eData=res.data.substr(2).split(","),res=(qrScan.stop(),await function(data){return new Promise(async resolve=>{fetchJson("/api/monitor,checkQr",{eq:parseInt(data[0],16),qr:data[1]}).then(resp=>{resolve(Number(resp.status))})})}(eData));switch(res){case 0:this.participar($("prueba").value,parseInt(eData[0],16));break;case 1060:alert("❌ QR de equipo inválido");break;default:alert("ERROR: ",""+data.data)}}},{returnDetailedScanResult:!0});$("QR").onclick=e=>(e.preventDefault(),$("qrContainer").style.display="flex",qrScan.start(),!($("cancelQr").onclick=()=>{qrScan.stop(),$("qrContainer").style.display="none"}))}}class PRUEBA{constructor(prueba,equipo){this.prueba=prueba,this.equipo=equipo,this.init()}init(){let el;(el=$("savePrueba"))&&(el.onclick=()=>{var res=$("resultado");this.send(res?res.dataset.raw:null)}),(el=$("superarObstaculo"))&&(el.onclick=()=>{this.send("true")}),(el=$("fallarObstaculo"))&&(el.onclick=()=>{this.send("false")})}send(resul){resul={prueba:this.prueba,equipo:this.equipo,resultado:resul};fetchJson("/api/monitor,participacion",resul).then(data=>{switch(Number(data.status)){case 0:location="/monitor";break;case 1041:alert("❌ El equipo no tiene intentos");break;case 1056:alert("❌ El equipo ya ha empezado la race");break;case 1057:alert("❌ El equipo no ha empezado la race");break;case 1058:alert("❌ Obstaculo inválido");break;case 1059:alert("❌ El equipo ya ha superado el obstáculo");break;case 1060:alert("❌ El equipo ya ha fallado el obstáculo");break;default:alert("ERROR: ",""+data.data)}})}}class LOGIN{static init(){$("loginForm").onsubmit=e=>{e.preventDefault();e={pass:$("pass").value};fetchJson("/api/monitor,login",e).then(resp=>{switch(Number(resp.status)){case 0:return location="/monitor",!0;case 1024:return alert("❌ Ya estás dentro del sistema"),!1;case 1026:return alert("❌ Contraseña vacía"),!1;case 1027:return alert("❌ Credenciales inválidas"),!1;default:return alert("❌ "+resp.data),!1}})}}}export{START,PRUEBA,LOGIN};
//# sourceMappingURL=module-monitor.min.js.map